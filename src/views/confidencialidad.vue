<template>
  <div :class="textSizeClass">
    <div class="card content" :class="textSizeClass">
      <div class="container">
        <div v-if="selectedLanguage === 'es'">
          <h2 class="title">ACUERDO DE CONFIDENCIALIDAD Y CUMPLIMIENTO</h2>
          <br />
          <div class="text">
            <p>
              Al objeto de garantizar la confidencialidad de los productos
              (diseños, publicaciones, patentes, entre otros) derivados del
              Gimnasio Bilingüe, programa de español para extranjeros, English
              for everyone y otros programas creados por FUNIFELT y que
              automáticamente hacen parte de la Fundación Internacional
              FUNIFELT, además de los secretos empresariales que rigen dentro de
              los procesos de mercadeo en trámites administrativos y educativos
              y se hace necesario la firma de un acuerdo que garantice unos
              niveles de confianza. El documento se firmará una vez aceptado y
              firmado el acuerdo por ambas partes.
              <br />
              <br />
              El contenido del acuerdo es el que figura a continuación. DE UNA
              PARTE: FUNDACIÓN INTERNACIONAL FUNIFELT y en su nombre y
              representación de EDELMIRA DÍAZ, en calidad de representante del
              departamento de jurídica.
              <br />
              <br />
              EXPONEN
              <br />
              <br />

              I – Que las partes, anteriormente citadas, están interesadas en el
              desarrollo del presente acuerdo, para lo cual, aceptaron celebrar
              el presente Acuerdo de Confidencialidad con el fin de establecer
              el procedimiento que regirá la custodia y no transmisión a
              terceros de la información distribuida por El Gimnasio Bilingüe y
              FUNIFELT, así como los derechos, responsabilidades y obligaciones
              inherentes en calidad de propietario de la referida información.
              <br />
              <br />
              II – Que las partes, en virtud de lo anteriormente expuesto,
              convinieron que el presente Acuerdo de Confidencialidad se rija
              por la normativa aplicable al efecto y, en especial por las
              siguientes.
              <br />
              <br />
              CLÁUSULAS
              <br />
              <br />
              PRIMERA - Definiciones
              <br />
              <br />
              A los efectos del presente Acuerdo, los siguientes términos serán
              interpretados de acuerdo con las definiciones anexas a los mismos.
              Entendiéndose por:
              <br />
              <br />
              - «Información propia»: tendrá tal consideración y a título
              meramente enunciativo y no limitativo, lo siguiente:
              descubrimientos, conceptos, ideas, conocimientos, técnicas,
              diseños, dibujos, borradores, diagramas, textos, modelos,
              muestras, bases de datos de cualquier tipo, aplicaciones,
              programas, marcas, logotipos, así como cualquier información de
              tipo técnico, industrial, financiero, publicitario, de carácter
              personal o comercial de cualquiera de las partes, esté o no
              incluida en la solicitud de oferta presentada, independientemente
              de su formato de presentación o distribución, y aceptada por los
              «Destinatarios».
              <br />
              <br />
              - «Fuente»: tendrá la consideración de tal, cualquiera de las
              partes cuando, dentro de los términos del presente Acuerdo, sea
              ella la que suministre la Información Propia y/o cualquiera de los
              implicados de El Gimnasio Bilingüe y FUNIFELT.
              <br />
              <br />
              - «Destinatarios»: tendrán la consideración de tales cualquiera de
              las partes cuando, dentro de los términos del presente Acuerdo,
              sea ellos quienes reciban la Información Propia de la otra parte.
              <br />
              <br />
              SEGUNDA.- Información Propia.
              <br />
              <br />
              Las partes acuerdan que cualquier información relativa a sus
              aspectos financieros, comerciales, técnicos, y/o industriales
              suministrada a la otra parte como consecuencia de la solicitud de
              Oferta para el desarrollo del presente proyecto o actividad, o en
              su caso, de los acuerdos a los que se lleguen (con independencia
              de que tal transmisión sea oral, escrita, en soporte magnético o
              en cualquier otro mecanismo informático, gráfico, o de la
              naturaleza que sea) tendrá consideración de información
              confidencial y será tratada de acuerdo con lo establecido en el
              presente documento. Esa información, y sus copias y/o
              reproducciones tendrán la consideración de «Información propia»
              los efectos del presente acuerdo.
              <br />
              <br />
              TERCERA.- Exclusión del Presente Acuerdo.
              <br />
              <br />
              No se entenderá por «Información propia», ni recibirá tal
              tratamiento aquella información que: I – Sea de conocimiento
              público en el momento de su notificación al «Destinatario» o
              después de producida la notificación alcance tal condición de
              pública, sin que para ello el «Destinatario» violentara lo
              establecido en el presente acuerdo, es decir, no fuera el
              «Destinatario» la causa o «Fuente» última de la divulgación de
              dicha información. II – Pueda ser probado por el «Destinatario»,
              de acuerdo con sus archivos, debidamente comprobados por la
              «Fuente», que estaba en posesión de la misma por medios legítimos
              sin que estuviese vigente en ese momento algún y anterior acuerdo
              de confidencialidad al suministro de dicha información por su
              legítimo creador. III – Fuese divulgada masivamente sin limitación
              alguna por su legítimo creador. IV – Fuese creada completa e
              independientemente por el «Destinatario», pudiendo este demostrar
              este extremo, de acuerdo con sus archivos, debidamente comprobados
              por la «Fuente».
              <br />
              <br />
              CUARTA.- Custodia y no divulgación.
              <br />
              <br />
              Las partes consideran confidencial la «Información propia» de la
              otra parte que le pudiera suministrar y acuerdan su guarda y
              custodia estricta, así como a su no divulgación o suministro, ni
              en todo ni en parte, a cualquier tercero sin el previo, expreso y
              escrito consentimiento de «Fuente». Tal consentimiento no será
              necesario cuando la obligación de suministrar o divulgar la
              «Información propia» de la «Fuente» por parte del «Destinatario»
              venga impuesta por Ley en vigor o Sentencia Judicial Firme. Este
              Acuerdo no autoriza a ninguna practicante, trabajador u otra
              persona que haga parte de los procesos en FUNIFELT a apropiarse de
              la información suministrada, por lo cual FUNIFELT puede solicitar
              o exigir de la otra parte el suministro de información, y
              cualquier obtención de información de/o sobre la «Fuente» por
              parte del «Destinatario» será recibida del mismo modo, toda
              información que se convierta en publica y abierta debe hacerse con
              el previo consentimiento del comité directivo de FUNIFELT.
              <br />
              <br />
              QUINTA.- Soporte de la «Información propia».
              <br />
              <br />
              Toda o parte de la «Información propia», papeles, libros, cuentas,
              grabaciones, listas de clientes y/o socios, programas de
              ordenador, procedimientos, documentos de todo tipo o tecnología en
              el que el suministro fuese hecho bajo la condición de «Información
              propia», con independencia del soporte que la contuviera, tendrá
              la clasificación de secreta, confidencial o restringida que
              solamente puede ser manejada por FUNIFELT
              <br />
              <br />
              SEXTA.- Responsabilidad en la Custodia de la «Información propia».
              <br />
              <br />
              La «Información propia» podrá ser dada a conocer por el
              «Destinatario» o sus directivos y/o sus empleados, sin perjuicio
              de que el «Destinatario» tome cuentas medidas sean necesarias para
              el exacto y fiel cumplimento del presente Acuerdo, debiendo
              necesariamente informar a unos y otros del carácter secreto,
              confidencial, o restringido de la información que da a conocer,
              así como da existencia del presente Acuerdo.
              <br />
              <br />
              Así mismo, el «Destinatario» deberá dar a sus directivos y/o sus
              empleados, las directrices e instrucciones que considere oportunas
              y convenientes a los efectos de mantener el secreto, confidencial,
              o restringido e incluso el uso de la información propia de la
              «Fuente». El «Destinatario» deberá advertir a todos sus
              directivos, empleados, etc., que de acuerdo con lo dispuesto en
              este acuerdo tengan acceso a la «Información propia», de las
              consecuencias y responsabilidades en las que el «Destinatario»
              puede incurrir por la infracción por parte de dichas personas, de
              lo dispuesto en este Acuerdo.
              <br />
              <br />
              Sin perjuicio de lo anterior, la «Fuente» podrá pedir y recabar
              del «Destinatario», como condición previa al suministro de la
              «Información propia», una lista de los directivos y empleados que
              tendrán acceso a dicha información, lista que podrá ser
              restringida o reducida por la «Fuente».
              <br />
              <br />
              Esta lista será firmada por cada uno de los directivos y empleados
              que figuren en ella, manifestando expresamente que conocen la
              existencia del presente Acuerdo y que actuarán de conformidad con
              lo previsto en él. Cualquier modificación de la lista de
              directivos y/o empleados a la que se hizo referencia anteriormente
              será comunicada de forma inmediata a la «Fuente», por escrito
              conteniendo los extremos indicados con anterioridad en este
              párrafo.
              <br />
              <br />
              Sin perjuicio de lo previsto en los párrafos anteriores, cada
              parte será responsable tanto de la conducta dos sus directivos y/o
              empleados como de las consecuencias que de ella se pudieran
              derivarse de conformidad con lo previsto en el presente Acuerdo.
              <br />
              <br />
              SÉPTIMA.- Responsabilidad en la custodia de la «Información
              propia».
              <br />
              <br />
              El «Destinatario» será responsable de la custodia de la
              «Información propia» y cuantas copias pudiera tener de la misma
              suministrada por la «Fuente», en orden a su tratamiento, como
              secreta, confidencial o restringida, en el momento presente y
              futuro, salvo indicación explicita de la «Fuente». Al objeto de
              garantizar esta custodia, se deberá devolver la «Información
              propia» y cuantas copias pudiera tener de la misma suministrada
              por la «Fuente», a la terminación de las relaciones académicas,
              laborales y/o comerciales, o antes, si fuera requerido por la
              «Fuente» y respondiendo a los daños y perjuicios correspondientes,
              en el caso de incumplimiento de lo aquí dispuesto. Todo debe
              devolverse sin excepción a las directivas de FUNIFELT.
              <br />
              <br />
              OCTAVA.- Incumplimiento.
              <br />
              <br />
              El incumplimiento de las obligaciones de confidencialidad
              plasmadas en este documento facultará a FUNIFELT a reclamar por la
              vía legal que estime más procedente, a la indemnización de los
              daños y perjuicios ocasionados, incluido el lucro cesante. En el
              caso de ser un estudiante-practicante se adiciona que no pueden
              abandonar su proceso de practica asumiendo las consecuencias que
              conlleva a partir del reglamento interno institucional (no se
              validan horas, se reporta directamente a la institución, se
              realiza un seguimiento completo del proceso)
              <br />
              <br />
              Todo empleado/estudiante está obligado al cuidado de los
              implementos otorgados y la devolución y/o reposición del mismo
              según sea el caso.
              <br />
              <br />
              NOVENA.- Duración del Acuerdo de Confidencialidad.
              <br />
              <br />
              Ambas partes acuerdan mantener el presente Acuerdo de
              Confidencialidad, aún después de terminar sus relaciones
              laborales, académicas y/o comerciales.
              <br />
              <br />
              DECIMA. - Legislación Aplicable
              <br />
              <br />
              El presente Acuerdo de Confidencialidad se regirá por la
              Legislación Internacional, y cualquier disputa, controversia o
              conflicto en cuanto a la interpretación o ejecución del presente
              Acuerdo será sometido a la jurisdicción de los Tribunales en
              Colombia.
              <br />
              <br />
              Y en prueba de esta conformidad, las partes firman o presente
              acuerdo, por duplicado y a un solo efecto, en el lugar y fecha ut
              supra.
              <br />
              <br />
              (archivos registrados digital y físicamente para los fines
              pertinentes)
            </p>
          </div>
        </div>
        <div v-if="selectedLanguage === 'en'">
          <h2 class="title">CONFIDENTIALITY AND COMPLIANCE AGREEMENT</h2>
          <br />
          <div class="text">
            <p>
              In order to ensure the confidentiality of the products (designs,
              publications, patents, among others) derived from Gimnasio
              Bilingüe, the Spanish program for foreigners, English for
              Everyone, and other programs created by FUNIFELT that
              automatically become part of the FUNIFELT International
              Foundation, as well as the trade secrets that govern marketing
              processes in administrative and educational procedures, it is
              necessary to sign an agreement that guarantees levels of trust.
              The document will be signed once the agreement is accepted and
              signed by both parties.
              <br />
              <br />
              The content of the agreement is as follows. ON ONE PART: FUNIFELT
              INTERNATIONAL FOUNDATION and represented by EDELMIRA DÍAZ, as the
              representative of the legal department.
              <br />
              <br />
              STATE
              <br />
              <br />

              I – That the parties, previously mentioned, are interested in
              developing this agreement, for which they agreed to enter into
              this Confidentiality Agreement to establish the procedure that
              will govern the custody and non-disclosure to third parties of the
              information distributed by Gimnasio Bilingüe and FUNIFELT, as well
              as the rights, responsibilities, and obligations inherent as the
              owner of the said information.
              <br />
              <br />
              II – That the parties, by virtue of the above, agreed that this
              Confidentiality Agreement will be governed by the applicable
              regulations and, in particular, by the following.
              <br />
              <br />
              CLAUSES
              <br />
              <br />
              FIRST - Definitions
              <br />
              <br />
              For the purposes of this Agreement, the following terms will be
              interpreted according to the definitions attached to them.
              Understood by:
              <br />
              <br />
              - "Proprietary Information": will have such consideration and, by
              way of example and not limitation, the following: discoveries,
              concepts, ideas, knowledge, techniques, designs, drawings, drafts,
              diagrams, texts, models, samples, databases of any kind,
              applications, programs, trademarks, logos, as well as any
              information of a technical, industrial, financial, advertising,
              personal, or commercial nature of either party, whether or not
              included in the offer request submitted, regardless of its
              presentation or distribution format, and accepted by the
              "Recipients".
              <br />
              <br />
              - "Source": will be considered any of the parties when, within the
              terms of this Agreement, it is the one supplying the Proprietary
              Information and/or any of the parties involved from Gimnasio
              Bilingüe and FUNIFELT.
              <br />
              <br />
              - "Recipients": will be considered such any of the parties when,
              within the terms of this Agreement, they receive the Proprietary
              Information from the other party.
              <br />
              <br />
              SECOND.- Proprietary Information.
              <br />
              <br />
              The parties agree that any information related to their financial,
              commercial, technical, and/or industrial aspects provided to the
              other party as a result of the offer request for the development
              of this project or activity, or as a result of the agreements
              reached (regardless of whether such transmission is oral, written,
              on magnetic media, or any other computer, graphic, or any other
              mechanism) will be considered confidential information and will be
              treated in accordance with the provisions of this document. This
              information, and its copies and/or reproductions, will be
              considered "Proprietary Information" for the purposes of this
              agreement.
              <br />
              <br />
              THIRD.- Exclusion from This Agreement.
              <br />
              <br />
              It will not be understood as "Proprietary Information", nor will
              it receive such treatment, the information that: I – Is public
              knowledge at the time of its notification to the "Recipient" or
              after the notification becomes public, without the "Recipient"
              violating the provisions of this agreement, that is, the
              "Recipient" is not the ultimate cause or "Source" of the
              disclosure of such information. II – Can be proven by the
              "Recipient", according to its files, duly verified by the
              "Source", that it was in possession of it by legitimate means
              without any previous confidentiality agreement being in force at
              the time of supplying such information by its legitimate creator.
              III – Was disclosed massively without any limitation by its
              legitimate creator. IV – Was created completely and independently
              by the "Recipient", being able to demonstrate this, according to
              its files, duly verified by the "Source".
              <br />
              <br />
              FOURTH.- Custody and non-disclosure.
              <br />
              <br />
              The parties consider the "Proprietary Information" of the other
              party that it may provide as confidential and agree to its strict
              custody and non-disclosure or supply, in whole or in part, to any
              third party without the prior, express, and written consent of the
              "Source". Such consent will not be necessary when the obligation
              to supply or disclose the "Proprietary Information" of the
              "Source" by the "Recipient" is imposed by a law in force or a
              Final Judicial Sentence. This Agreement does not authorize any
              intern, worker, or other person involved in FUNIFELT processes to
              appropriate the supplied information, so FUNIFELT may request or
              require the other party to supply information, and any obtaining
              of information from/about the "Source" by the "Recipient" will be
              received in the same way; all information that becomes public and
              open must be done with the prior consent of the FUNIFELT board of
              directors.
              <br />
              <br />
              FIFTH.- Support of the "Proprietary Information".
              <br />
              <br />
              All or part of the "Proprietary Information", papers, books,
              accounts, recordings, customer and/or partner lists, computer
              programs, procedures, all types of documents, or technology where
              the supply was made under the condition of "Proprietary
              Information", regardless of the medium containing it, will have
              the classification of secret, confidential or restricted that can
              only be handled by FUNIFELT.
              <br />
              <br />
              SIXTH.- Responsibility for the Custody of the "Proprietary
              Information".
              <br />
              <br />
              The "Proprietary Information" may be disclosed by the "Recipient"
              or its executives and/or employees, without prejudice to the
              "Recipient" taking the necessary measures for the exact and
              faithful fulfillment of this Agreement, necessarily informing them
              of the secret, confidential, or restricted nature of the
              information being disclosed, as well as the existence of this
              Agreement.
              <br />
              <br />
              Likewise, the "Recipient" must give its executives and/or
              employees the guidelines and instructions it considers appropriate
              and convenient for the purpose of maintaining the secret,
              confidential, or restricted nature and even the use of the
              "Source's" proprietary information. The "Recipient" must warn all
              its executives, employees, etc., who, according to the provisions
              of this agreement, have access to the "Proprietary Information",
              of the consequences and responsibilities that the "Recipient" may
              incur for the infringement by such persons of the provisions of
              this Agreement.
              <br />
              <br />
              Without prejudice to the foregoing, the "Source" may request and
              obtain from the "Recipient", as a condition prior to supplying the
              "Proprietary Information", a list of the executives and employees
              who will have access to such information, a list that may be
              restricted or reduced by the "Source".
              <br />
              <br />
              This list will be signed by each of the executives and employees
              listed, expressly stating that they are aware of the existence of
              this Agreement and that they will act in accordance with its
              provisions. Any modification of the list of executives and/or
              employees referred to above will be immediately communicated to
              the "Source", in writing containing the aforementioned terms in
              this paragraph.
              <br />
              <br />
              Without prejudice to the provisions of the previous paragraphs,
              each party will be responsible for the conduct of its executives
              and/or employees and the consequences that may arise from it in
              accordance with the provisions of this Agreement.
              <br />
              <br />
              SEVENTH.- Responsibility for the custody of the "Proprietary
              Information".
              <br />
              <br />
              The "Recipient" will be responsible for the custody of the
              "Proprietary Information" and any copies it may have of it
              supplied by the "Source", in order to treat it as secret,
              confidential, or restricted, at present and in the future, unless
              explicitly indicated by the "Source". To ensure this custody, the
              "Proprietary Information" and any copies of it supplied by the
              "Source" must be returned at the end of the academic, labor,
              and/or commercial relations, or earlier, if required by the
              "Source" and responding to the corresponding damages and losses,
              in case of non-compliance with the provisions herein. Everything
              must be returned without exception to FUNIFELT directives.
              <br />
              <br />
              EIGHTH.- Non-compliance.
              <br />
              <br />
              Non-compliance with the confidentiality obligations set forth in
              this document will entitle FUNIFELT to claim by the legal means it
              deems most appropriate, compensation for the damages caused,
              including lost profits. In the case of being a student-intern, it
              is added that they cannot abandon their internship process,
              assuming the consequences arising from the institutional internal
              regulations (hours are not validated, it is reported directly to
              the institution, a complete follow-up of the process is carried
              out).
              <br />
              <br />
              Every employee/student is obliged to take care of the provided
              equipment and to return and/or replace it as necessary.
              <br />
              <br />
              NINTH.- Duration of the Confidentiality Agreement.
              <br />
              <br />
              Both parties agree to maintain this Confidentiality Agreement even
              after their labor, academic, and/or commercial relationships end.
              <br />
              <br />
              TENTH.- Applicable Legislation
              <br />
              <br />
              This Confidentiality Agreement will be governed by International
              Legislation, and any dispute, controversy, or conflict regarding
              the interpretation or execution of this Agreement will be
              submitted to the jurisdiction of the Courts in Colombia.
              <br />
              <br />
              And in proof of this conformity, the parties sign this agreement,
              in duplicate and to a single effect, at the place and date
              mentioned above.
              <br />
              <br />
              (digitally and physically registered files for pertinent purposes)
            </p>
          </div>
        </div>
        <form @submit.prevent="submit" v-if="selectedLanguage === 'es'">
          <div class="card">
            <div class="row">
              <label>Correo</label>
              <input
                type="text"
                v-model="formConfidencialidad.email"
                id="email"
                placeholder="example@mail.com"
                required
                readonly
              />
              <span v-if="!isValidEmail" style="color: red">
                Por favor ingrese un correo electrónico válido.
              </span>
            </div>
            <div class="row">
              <label>Discapacidades</label>
              <div class="discapacidades">
                <multiselect
                  v-model="formConfidencialidad.disability"
                  :options="discapacidades"
                  :multiple="true"
                  :close-on-select="false"
                  :clear-on-select="false"
                  :preserve-search="true"
                  @update="checkOptions"
                  placeholder="Selecciona opciones"
                  label="name_es"
                  value="name_es"
                  track-by="name_es"
                />
                <br v-if="isOtroSelected" />
                <input
                  v-if="isOtroSelected"
                  type="text"
                  id="textfield"
                  v-model="textFieldValue"
                  placeholder="Cuales otras"
                  required
                />
              </div>
            </div>

            <div class="row">
              <label for="">Nombre completo</label>
              <input
                type="text"
                placeholder="Ingresa tu nombre"
                id="fullname"
                v-model="formConfidencialidad.name"
                required
              />
            </div>
            <div class="row">
              <label for="identification"
                >Documento de Identidad, DNI, ID o Pasaporte:</label
              >
              <input
                type="text"
                v-model="formConfidencialidad.document"
                @input="validateIdentification"
                minlength="6"
                maxlength="20"
                id="document"
                placeholder="Ingresa tu documento"
                required
              />
              <span v-if="!isValidId" style="color: red"
                >Por favor ingrese un documento válido.</span
              >
            </div>
            <div class="row phone">
              <label for="phone">Número de Teléfono:</label>
              <div class="phone-input">
                <vue-tel-input
                  v-model="formConfidencialidad.phoneNumber"
                  mode="international"
                  @input="handleInput"
                  :inputOptions="{
                    inputClass: 'vue-tel-input__input',
                    type: 'tel',
                    pattern: '[0-9]{10}',
                    maxlength: '10',
                  }"
                  style="
                    width: 100%;
                    line-height: normal;
                    display: flex;
                    align-items: center;
                    height: 42px;
                  "
                  required
                ></vue-tel-input>
              </div>
            </div>
            <div class="row">
              <label for="address">Dirección:</label>
              <input
                type="text"
                id="address"
                v-model="formConfidencialidad.address"
                placeholder="Ingrese su dirección"
              />
            </div>
            <div class="row">
              <label for="country">País:</label>
              <select id="country" v-model="formConfidencialidad.country">
                <option value="" disabled selected>Selecciona un país</option>
                <option
                  v-for="(country, index) in countries"
                  :key="index"
                  :value="country.countryName"
                >
                  {{ country.countryName }}
                </option>
              </select>
            </div>

            <div class="file-row">
              <label for="fileInput" class="file-label">
                Subir un documento de identidad (PDF o imagen):
              </label>

              <input
                type="file"
                class="file-input"
                id="fileInput"
                accept=".pdf, image/*"
                @change="handleFileUpload"
              />

              <div v-if="formConfidencialidad.fileUrl" class="file-preview">
                <a :href="formConfidencialidad.fileUrl" target="_blank">
                  <span v-if="isImage(formConfidencialidad.fileUrl)">
                    <img
                      :src="formConfidencialidad.fileUrl"
                      alt="Documento cargado"
                      class="file-thumbnail"
                    />
                  </span>
                  <span v-else class="btn-view">📄</span>
                </a>
              </div>
            </div>

            <div class="row">
              <div class="confirm">
                <label for=""
                  >Confirmo que acepto la información suministrada
                </label>
              </div>
              <div class="checks">
                <input
                  type="radio"
                  name="confirmacion"
                  v-model="formConfidencialidad.confirmacion"
                  value="si"
                />
                <label for="">Si</label>
                &nbsp;
                <input
                  type="radio"
                  name="confirmacion"
                  v-model="formConfidencialidad.confirmacion"
                  value="no"
                />
                <label for="">No</label>
              </div>
            </div>
            <div class="button">
              <button class="btn btn-primary" type="submit" @click="submit()">
                {{ consentExists ? "Actualizar" : "Enviar" }}
              </button>
            </div>
          </div>
        </form>
        <form @submit.prevent="submit" v-if="selectedLanguage === 'en'">
          <div class="card">
            <div class="row">
              <label>Email</label>
              <input
                type="text"
                v-model="formConfidencialidad.email"
                id="email"
                placeholder="example@mail.com"
                required
                readonly
              />
              <span v-if="!isValidEmail" style="color: red">
                Please place a valid email.
              </span>
            </div>
            <div class="row">
              <label>Disabilities</label>
              <div class="discapacidades">
                <multiselect
                  v-model="formConfidencialidad.disability"
                  :options="discapacidades"
                  :multiple="true"
                  :close-on-select="false"
                  :clear-on-select="false"
                  :preserve-search="true"
                  @update="checkOptions"
                  placeholder="Select options"
                  label="name_en"
                  value="name_en"
                  track-by="name_en"
                />
                <br v-if="isOtroSelected" />
                <input
                  v-if="isOtroSelected"
                  type="text"
                  id="textfield"
                  v-model="textFieldValue"
                  placeholder="Which other"
                  required
                />
              </div>
            </div>

            <div class="row">
              <label for="">Full Name</label>
              <input
                type="text"
                placeholder="Enter your name"
                id="fullname"
                v-model="formConfidencialidad.name"
                required
              />
            </div>
            <div class="row">
              <label for="identification">Document, DNI, ID o Passport:</label>
              <input
                type="text"
                v-model="formConfidencialidad.document"
                @input="validateIdentification"
                minlength="6"
                maxlength="20"
                id="document"
                placeholder="Enter your document"
                required
              />
              <span v-if="!isValidId" style="color: red"
                >Please place a valid document.</span
              >
            </div>
            <div class="row phone">
              <label for="phone">Phone Number:</label>
              <div class="phone-input">
                <vue-tel-input
                  v-model="formConfidencialidad.phoneNumber"
                  mode="international"
                  @input="handleInput"
                  :inputOptions="{
                    inputClass: 'vue-tel-input__input',
                    type: 'tel',
                    pattern: '[0-9]{10}',
                    maxlength: '10',
                  }"
                  style="
                    width: 100%;
                    line-height: normal;
                    display: flex;
                    align-items: center;
                    height: 42px;
                  "
                  required
                ></vue-tel-input>
              </div>
            </div>
            <div class="row">
              <label for="address">Adress:</label>
              <input
                type="text"
                id="address"
                v-model="formConfidencialidad.address"
                placeholder="Enter your adress"
              />
            </div>
            <div class="row">
              <label for="country">Country:</label>
              <select id="country" v-model="formConfidencialidad.country">
                <option value="" disabled selected>Select a county</option>
                <option
                  v-for="(country, index) in countries"
                  :key="index"
                  :value="country.countryName"
                >
                  {{ country.countryName }}
                </option>
              </select>
            </div>
            <div class="file-row">
              <label for="fileInput" class="file-label">
                Upload an ID document (PDF or image):
              </label>

              <input
                type="file"
                class="file-input"
                id="fileInput"
                accept=".pdf, image/*"
                @change="handleFileChange"
              />

              <div v-if="formConfidencialidad.fileUrl" class="file-preview">
                <a :href="formConfidencialidad.fileUrl" target="_blank">
                  <span v-if="isImage(formConfidencialidad.fileUrl)">
                    <img
                      :src="formConfidencialidad.fileUrl"
                      alt="Documento cargado"
                      class="file-thumbnail"
                    />
                  </span>
                  <span v-else class="btn-view">📄</span>
                </a>
              </div>
            </div>
            <div class="row">
              <div class="confirm">
                <label for=""
                  >I confirm that I accept the provided information
                </label>
              </div>
              <div class="checks">
                <input
                  type="radio"
                  name="confirmacion"
                  v-model="formConfidencialidad.confirmacion"
                  value="si"
                />
                <label for="">Yes</label>
                &nbsp;
                <input
                  type="radio"
                  name="confirmacion"
                  v-model="formConfidencialidad.confirmacion"
                  value="no"
                />
                <label for="">No</label>
              </div>
            </div>
            <div class="button">
              <button class="btn btn-primary" type="submit" @click="submit()">
                {{ consentExists ? "Update" : "Submit" }}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</template>

<script>
// Importación de componentes y librerías necesarias
import Multiselect from "vue-multiselect";
import "vue-multiselect/dist/vue-multiselect.esm.css";
import { defineComponent, ref, onMounted } from "vue";
import countries from "@/utils/countryInfo.json";
import disabilities from "@/utils/disabilities.json";
import VueCountryRegionSelect from "vue-country-region-select";
import TextSizeSelector from "@/components/textSizeSelector.vue";
import {
  storage,
  ref as storageRef,
  uploadBytes,
  getDownloadURL,
} from "@/firebase";

import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  updateDoc,
} from "firebase/firestore";
import { toast } from "vue3-toastify";
import "vue3-toastify/dist/index.css";
import { VueTelInput } from "vue-tel-input";

// Importación de Firebase Auth y Firestore (antes Realtime Database)
import { getAuth, onAuthStateChanged } from "firebase/auth";

export default defineComponent({
  components: {
    Multiselect,
    VueCountryRegionSelect,
    TextSizeSelector,
    VueTelInput,
  },
  props: {
    textSizeClass: {
      type: String,
      default: "medium-text",
    },
    selectedLanguage: {
      type: String,
      required: true,
    },
  },
  setup() {
    const phone = ref(null);
    const formConfidencialidad = ref({
      email: "",
      disability: [],
    });

    const isValidEmail = ref(true);
    const auth = getAuth();

    onMounted(async () => {
      onAuthStateChanged(auth, async (loggedUser) => {
        if (loggedUser) {
          formConfidencialidad.value.email = loggedUser.email || "";

          const uid = loggedUser.uid;
          const db = getFirestore();
          const docRef = doc(db, "Confidencialidad", uid);

          try {
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
              formConfidencialidad.value = { ...docSnap.data() };
              console.log(
                "Datos cargados desde Firestore:",
                formConfidencialidad.value
              );
            } else {
              console.log("No hay datos previos en Firestore.");
            }
          } catch (error) {
            console.error("Error al obtener los datos de Firestore:", error);
          }
        }
      });
    });

    return { formConfidencialidad, isValidEmail, phone };
  },
  data() {
    return {
      formConfidencialidad: {
        email: "",
        confirmacion: { si: false, no: false },
        disability: [],
        name: "",
        document: "",
        country: "",
        phoneNumber: "",
        address: "",
        file: "",
      },
      countryCode: "+57",
      phoneNumber: "",
      showTextField: false,
      textFieldValue: "",
      identificationNumber: "",
      isValidId: true,
      isValidEmail: true,
      countries: {},
      formValid: false,
      errorMessages: [],
      toast: {
        show: false,
        message: "",
        type: "",
      },
      discapacidades: [],
      isSubmitting: false,
    };
  },
  async mounted() {
    try {
      this.discapacidades = disabilities.map((discapacidad) => ({
        name_es: discapacidad.name_es,
        name_en: discapacidad.name_en,
      }));

      this.countries = countries.map((country) => ({
        countryCode: country.countryCode,
        countryName: country.country,
      }));
    } catch (error) {
      console.error("Error al obtener los datos:", error);
    }
  },
  methods: {
    validateEmail() {
      const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      this.isValidEmail = regex.test(this.formConfidencialidad.email);
    },
    handleFileUpload(event) {
      const file = event.target.files[0];
      if (file) {
        console.log("Archivo seleccionado:", file);
        this.formConfidencialidad.file = file;
      }
    },
    isImage(fileUrl) {
      return /\.(jpeg|jpg|png|gif)$/i.test(fileUrl);
    },
    validateForm() {
      this.errorMessages = [];
      const {
        email,
        name,
        document,
        country,
        phoneNumber,
        address,
        file,
        confirmacion,
        disability,
      } = this.formConfidencialidad;

      if (!name) this.errorMessages.push("El nombre es requerido.");
      if (!document) this.errorMessages.push("El documento es requerido.");
      if (!country) this.errorMessages.push("El país es requerido.");
      if (!phoneNumber)
        this.errorMessages.push("El número de teléfono es requerido.");
      if (!address) this.errorMessages.push("La dirección es requerida.");
      if (!file && !this.formConfidencialidad.fileUrl) {
        this.errorMessages.push("El archivo es requerido.");
      }
      if (!confirmacion)
        this.errorMessages.push("La confirmación es requerida.");
      if (disability.length === 0)
        this.errorMessages.push("La discapacidad es requerida.");
      if (!email)
        this.errorMessages.push("El correo electrónico es requerido.");
      if (!this.isValidId)
        this.errorMessages.push("El número de identificación no es válido.");

      this.formValid = this.errorMessages.length === 0;
    },
    async submit() {
      if (this.isSubmitting) return;
      this.isSubmitting = true;

      this.validateForm();
      if (!this.formValid) {
        this.errorMessages.forEach((message) =>
          toast.error(message, { autoClose: 2000 })
        );
        this.isSubmitting = false;
        return;
      }

      const auth = getAuth();
      const currentUser = auth.currentUser;
      if (!currentUser) {
        toast.error("No hay usuario autenticado.");
        this.isSubmitting = false;
        return;
      }

      const file = this.formConfidencialidad.file;
      let fileUrl = this.formConfidencialidad.fileUrl || ""; // Mantener archivo si ya existe

      // Si hay un nuevo archivo, lo subimos
      if (file) {
        const sanitizedFileName = file.name.replace(/\s+/g, "_");
        const storageReference = storageRef(
          storage,
          `filesConfidencialidad/${sanitizedFileName}`
        );

        try {
          const snapshot = await uploadBytes(storageReference, file);
          fileUrl = await getDownloadURL(snapshot.ref);
        } catch (error) {
          console.error("Error al subir el archivo:", error);
          toast.error("Error al subir el archivo.");
          this.isSubmitting = false;
          return;
        }
      }

      const uid = currentUser.uid;
      const db = getFirestore();
      const consentRef = doc(db, "Confidencialidad", uid);

      const dataToSend = {
        userId: uid,
        ...this.formConfidencialidad,
        timestamp: new Date().toISOString(),
      };

      // Solo incluir fileUrl si hay archivo o ya existía uno
      if (fileUrl) {
        dataToSend.fileUrl = fileUrl;
      }

      delete dataToSend.file; // Eliminar el archivo antes de guardar en Firestore

      try {
        const docSnap = await getDoc(consentRef);
        const mensaje = docSnap.exists()
          ? "Confidencialidad actualizada correctamente"
          : "Confidencialidad enviada correctamente";

        if (docSnap.exists()) {
          await updateDoc(consentRef, dataToSend);
        } else {
          await setDoc(consentRef, dataToSend);
        }

        this.consentExists = true;
        localStorage.setItem("Confidencialidad", "true");

        toast.success(mensaje, { autoClose: 1000 });

        setTimeout(() => {
          this.$router.push("/principal");
        }, 1500);
      } catch (error) {
        console.error("Error al enviar los datos:", error);
        toast.error("Error al enviar los datos.");
      } finally {
        this.isSubmitting = false;
      }
    },
  },
});
</script>

<style scoped>
.container {
  align-content: center;
  /* Centra el contenido verticalmente dentro del contenedor */
}

.title {
  text-align: center;
  /* Centra el texto horizontalmente */
  margin-bottom: 1rem;
  /* Espacio inferior de 1 rem */
}

.card {
  padding: rem;
  /* Aquí probablemente falte el valor, debería ser por ejemplo 'padding: 1rem;' */
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
  /* Sombra ligera para la tarjeta */
  background-image: url("./background.jpg"); /* Ruta de la imagen */
  background-size: cover; /* Ajusta la imagen para cubrir todo el fondo */
  background-position: center; /* Centra la imagen en el fondo */
  background-repeat: no-repeat; /* Evita que la imagen se repita */
}

.content {
  background-image: url("./background.jpg"); /* Ruta de la imagen */
  background-size: cover; /* Ajusta la imagen para cubrir todo el fondo */
  background-position: center; /* Centra la imagen en el fondo */
  background-repeat: no-repeat; /* Evita que la imagen se repita */
}
.row {
  display: grid;
  /* Usa el modelo de caja grid */
  grid-template-columns: 25% 75%;
  /* Divide la fila en dos columnas, 25% y 75% de ancho respectivamente */
  margin-bottom: 1rem;
  /* Espacio inferior de 1 rem */
  gap: 0.5rem;
  /* Espacio entre las celdas del grid */
}

.label {
  font-weight: bold;
  /* Peso de la fuente en negrita */
}

.error-msg {
  color: red;
  /* Color del texto rojo para mensajes de error */
}

.multiselect,
select {
  width: 100%;
  /* Ancho completo para multiselect y select */
}

.row > *:not(input) {
  padding-left: 0 !important;
  padding-right: 0 !important;
  /* Ajuste del padding para todos los elementos dentro de .row, excluyendo input */
}

input[type="text"],
select,
multiselect {
  width: 100%;
  /* Ancho completo para input tipo texto, select y multiselect */
  padding: 0.5rem;
  /* Relleno de 0.5 rem para estos elementos */
  border: 1px solid #ccc;
  /* Borde de 1 píxel sólido en color gris */
  border-radius: 4px;
  /* Borde redondeado con un radio de 4 píxeles */
  box-sizing: border-box;
  /* Caja de tamaño de borde */
}

.button {
  text-align: center;
  /* Centra el texto del botón horizontalmente */
  margin-top: 1rem;
  /* Espacio superior de 1 rem */
}

.file-row {
  display: flex;
  align-items: center; /* Alinea verticalmente todos los elementos */
  gap: 15px; /* Espacio entre elementos */
}

.file-label {
  white-space: nowrap; /* Evita que el texto del label se divida en varias líneas */
}

.file-input {
  flex-grow: 1; /* Permite que el input se ajuste al espacio disponible */
}

.file-preview {
  display: flex;
  align-items: center;
}

.file-thumbnail {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 5px;
  border: 1px solid #ccc;
}

.prueba {
  /* Ancho completo para input tipo texto, select y multiselect */
  padding: 0.5rem;
  /* Relleno de 0.5 rem para estos elementos */
  border: 1px solid #ccc;
  /* Borde de 1 píxel sólido en color gris */
  border-radius: 4px;
  /* Borde redondeado con un radio de 4 píxeles */
  box-sizing: border-box;
  /* Caja de tamaño de borde */
}

.file-button {
  text-decoration: none;
}

.btn-view {
  display: flex;
  align-items: center;
  gap: 5px;
  background-color: #007bff;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
}

.btn-view:hover {
  background-color: #0056b3;
}

@media (max-width: 768px) {
  .row {
    grid-template-columns: 100%;
    /* Una columna completa en pantallas pequeñas */
  }

  input[type="text"],
  select,
  multiselect {
    width: 100%;
    /* Ancho completo para estos elementos en pantallas pequeñas */
  }
}

@media (max-width: 320px) {
  .phone-input {
    display: grid;
    /* Usa el modelo de caja grid para .phone-input */
    grid-template-rows: auto auto;
    /* Dos filas automáticas */
    gap: 0.5rem;
    /* Espacio entre las filas */
  }

  .phone-input select,
  .phone-input input[type="tel"] {
    width: 100%;
    /* Ancho completo para select e input de tipo teléfono dentro de .phone-input */
  }
}
</style>
